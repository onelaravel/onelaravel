"use strict";(Object("undefined"!=typeof self?self:this).webpackChunkApp=Object("undefined"!=typeof self?self:this).webpackChunkApp||[]).push([[905],{445:(e,t,i)=>{i.d(t,{S:()=>V});var n=i(781),r=i(19),s=i(499),o=i(479),a=i(276),c=i(611),h=i(696),l=i(734),u=i(51),d=i(544);class E{constructor(e){const{instances:t,indexMap:i}=this.parseViewData(e);this.instances=t,this.indexMap=i,this.index=0,this.maxIndex=i.length-1}parseViewData(e){let t=e.instances||{};const i=new Map,n=Object.keys(t);return n.forEach(e=>{i.set(e,t[e])}),{instances:i,indexMap:n}}get(e=null){return null===e&&(e=this.index),this.index=e,this.instances.get(this.indexMap[e])??null}next(){return this.index++,this.get(this.index)}prev(){return this.index--,this.get(this.index)}getById(e){return this.instances.get(e)??null}scan(){let e=this.index;return this.index++,this.get(e)||(this.index--,null)}}class p{constructor(e){this.views=new Map,this.setViews(e)}setViews(e){"object"==typeof e&&e&&0!==Object.keys(e).length&&Object.keys(e).forEach(t=>{this.views.set(t,new E(e[t]))})}get(e){return this.views.get(e)??null}scan(e){return this.get(e)?.scan()??null}getInstance(e,t){return this.get(e)?.getById(t)??null}}class V{constructor(e=null){this.App=e,this.markupService=l.Fj,this.storageService=u.n.getInstance("onejs_view_data"),this.container=null,this.stateChangeListeners={},this.currentMasterView=null,this.Engine=o.I,this.State=a.P,this.templates=r.j,this._sections={},this._changedSections=[],this._stacks={},this.scanMode=!1,this._once={},this.vitualContainer=document.createElement("div"),this.vitualContainer.setAttribute("id","data-vitual-container"),this.vitualContainer.style.display="none",this.VIEW_MOUNTED_QUEUE=[],this.CURRENT_SUPER_VIEW=null,this.CURRENT_SUPER_VIEW_PATH=null,this.CURRENT_SUPER_VIEW_MOUNTED=!1,this.CURRENT_VIEW=null,this.CURRENT_VIEW_PATH=null,this.CURRENT_VIEW_MOUNTED=!1,this.SUPER_VIEW_STACK=[],this.ALL_VIEW_STACK=[],this.PAGE_VIEW=null,this.renderTimes=-1,this.cachedViews={},this.serverRenderData={},this.viewMap=new Map,this.cachedPageData=new Map,this.wrapperConfig={},this.listeners={},this.ssrData={},this.ssrViewManager=new p,this.cachedPageView=new Map,this.cachedTimes=600,this.SEO={tags:n.Q,updateItem:function(e,t){const i=this.tags[e];return!(!i||0==i.length||(i.forEach(e=>{let i=document.querySelector(e.selector);i||(i=document.createElement(e.tag),e.attrs&&Object.entries(e.attrs).forEach(([e,t])=>{i.setAttribute(e,t)}),document.head.appendChild(i)),e.attribute&&("@content"==e.attribute?i.textContent=t:i.setAttribute(e.attribute,t))}),0))}}}setApp(e){this.App=e}setContainer(e){this.container=e}init(e={}){this._sections={},this._stacks={},this._once={},this._changedSections=[],this.templates||(this.templates=r.j),this._currentScope="web",this.ssrData=e?.ssrData||{},this.ssrViewManager.setViews(this.ssrData)}getView(e){return this.templates[e]||null}loadView(e,t={},i=""){this.templates[e]&&this.clearOldRendering(),this.renderTimes++;let n=null;this.CURRENT_SUPER_VIEW_MOUNTED=!1;try{let r=!1;if(this.cachedTimes>0){let n=e.replace(".","_")+"_"+i?.replace(/\//g,"_");const s=this.storageService.get(n);s&&(t={...t,...s},r=!0)}let s=this.view(e,r?{...t}:null);if(!s)return n=`App.View.loadView: View '${e}' not found`,{error:`App.View.loadView: View '${e}' not found`,html:null,superView:null,isSuperView:!1,needInsert:!1};if(i&&(s.urlPath=i),this.cachedTimes>0&&this.PAGE_VIEW instanceof o.I){const e=this.PAGE_VIEW.data;let t=this.PAGE_VIEW.path.replace(".","_")+"_"+this.PAGE_VIEW.urlPath?.replace(/\//g,"_");this.storageService.set(t,e,3600)}let a,c=null,h=null,l=(s.path,s),u=0;do{try{s.hasSuperView?(this.ALL_VIEW_STACK.unshift(s),h=s.superViewPath,a=this.renderView(s),s=a,s.setIsSuperView(!0),s&&"object"==typeof s&&(c=s,l=s)):s.isSuperView?(h!==s.path&&(this.SUPER_VIEW_STACK.unshift(s),h=s.path),c=s,s.hasSuperView?(a=this.renderView(s,u>0?s.data:null),s=a,s.setIsSuperView(!0),s&&"object"==typeof s&&(c=s,h=s.path,l=s)):a=""):(this.ALL_VIEW_STACK.unshift(s),a=this.renderView(s,u>0?s.data:null),l=s)}catch(t){return n=`App.View.loadView: Error rendering view '${e}':`+t.message,console.error("ðŸ” App.View.loadView error:",t),""}u++}while(a&&"object"==typeof a&&a instanceof o.I);try{let e=a;const t=!(h&&h===this.CURRENT_SUPER_VIEW_PATH);return h&&(t?(this.CURRENT_SUPER_VIEW_PATH=h,this.CURRENT_SUPER_VIEW=c,e=c.render()):this.CURRENT_SUPER_VIEW_MOUNTED=!0),{html:e,isSuperView:!!h,needInsert:t,superView:c,ultraView:l,error:null}}catch(e){n="App.View.loadView: Error updating DOM:"}}catch(t){n=`App.View.loadView: Critical error loading view '${e}':`}return{html:null,needInsert:!1,superView:null,ultraView:null,isSuperView:!1,error:n}}scanView(e,t=null){this.templates[e]&&this.clearOldRendering(),this.renderTimes++;let i=null;this.CURRENT_SUPER_VIEW_MOUNTED=!1;try{const n=this.ssrViewManager.scan(e);if(!n)return i=`App.View.scanView: View '${e}' not found`,{error:`App.View.scanView: View '${e}' not found`,html:null,superView:null,isSuperView:!1,needInsert:!1};const r=n.data;r.__SSR_VIEW_ID__=n.viewId;let s=this.view(e,r);if(!s)return i=`App.View.loadView: View '${e}' not found`,{error:`App.View.loadView: View '${e}' not found`,html:null,superView:null,isSuperView:!1,needInsert:!1};t&&t.$urlPath&&(s.urlPath=t.$urlPath);let o,a=null,c=null,l=(s.path,s);this.PAGE_VIEW=s,s.__scan(n);let u=0;do{try{if(s.hasSuperView){if(this.ALL_VIEW_STACK.unshift(s),c=s.superViewPath,o=this.scanRenderedView(s),s=o,s.setIsSuperView(!0),s&&"object"==typeof s&&(a=s,l=s,!s.isScanned)){const e=this.ssrViewManager.scan(c);e&&a.__scan(e)}}else if(s.isSuperView)if(c!==s.path&&(this.SUPER_VIEW_STACK.unshift(s),c=s.path,l=s),a=s,l=s,s.hasSuperView){if(o=this.scanRenderedView(s),s=o,s.setIsSuperView(!0),s&&"object"==typeof s&&(a=s,c=s.path,l=s,!s.isScanned)){const e=this.ssrViewManager.scan(c);e&&a.__scan(e)}}else o="";else this.ALL_VIEW_STACK.unshift(s),this.PAGE_VIEW=s,o=this.scanRenderedView(s),l=s}catch(t){return i=`App.View.scanView: Error rendering view '${e}':`,console.error("ðŸ” App.View.scanView error:",t),""}u++}while(o&&"object"==typeof o&&o.constructor===this.Engine);try{let e=o;const t=!(c&&c===this.CURRENT_SUPER_VIEW_PATH);return c&&(t?(this.CURRENT_SUPER_VIEW_PATH=c,this.CURRENT_SUPER_VIEW=a,this.CURRENT_SUPER_VIEW_MOUNTED=!1,e=a.virtualRender(),console.log("ðŸ” App.View.scanView render super view:",e)):(console.log("ðŸ” App.View.scanView need insert super view:",c),this.CURRENT_SUPER_VIEW_MOUNTED=!0)),this.mountAllViewsFromStack(this.renderTimes).then(()=>{h.Ay.log("âœ… View.scanView: All views mounted successfully in bottom-up order")}).catch(e=>{h.Ay.error("âŒ View.scanView: Error mounting views:",e)}),{html:e,isSuperView:!!c,needInsert:t,superView:a,ultraView:l,error:null}}catch(e){i="App.View.scanView: Error updating DOM:"+e.message}}catch(t){i=`App.View.scanView: Critical error loading view '${e}':`+t.message}return{html:null,needInsert:!1,superView:null,isSuperView:!1,ultraView:null,error:i}}mountView(e,t={},i=null){try{let n=this.CURRENT_SUPER_VIEW;n&&n instanceof o.I&&n.unmounted();const r=this.loadView(e,t,i?.$urlPath||"");if(r.error)return void console.error("View rendering error:",r.error);if(console.log("View rendered successfully:",r),r.needInsert&&r.html){const e=this.container||document.querySelector("#app-root")||document.querySelector("#app")||document.body,t=r.html;e&&d.A.setHTML(e,t)}else console.log("Router: Not updating DOM - needInsert:",r.needInsert,"html:",!!r.html);this.emitChangedSections&&this.emitChangedSections(),r.ultraView&&r.ultraView instanceof o.I&&r.ultraView.mounted(),this.CURRENT_SUPER_VIEW_MOUNTED=!0}catch(e){console.error("Error rendering view:",e)}}mountViewScan(e,t={},i=null){const n=this.scanView(e);n.error?console.error("âŒ Router.hydrateViews: Scan error:",n.error):(n.ultraView&&n.ultraView instanceof o.I&&n.ultraView.mounted(),this.CURRENT_SUPER_VIEW_MOUNTED=!0,this._isHydrated=!0)}mountContent(e){const t=this.container||document.querySelector("#app-root")||document.querySelector("#app")||document.body;t&&d.A.setHTML(t,e)}on(e,t){return"string"==typeof e&&""!==e&&"function"==typeof t&&(this.listeners[e]||(this.listeners[e]=[]),void this.listeners[e].push(t))}off(e,t){return"string"==typeof e&&""!==e&&"function"==typeof t&&void(this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter(e=>e!==t)))}emit(e,...t){if("string"!=typeof e||""===e)return!1;this.listeners[e]&&this.listeners[e].forEach(e=>e(...t))}generateViewId(){return(0,s.bD)()}execute(e,t=""){try{const i=e();return void 0!==i?i:t}catch(e){return h.Ay.error("App.execute error:",e),t}}evaluate(e,t=""){try{const i=e();return void 0!==i?i:t}catch(e){return h.Ay.error("App.evaluate error:",e),t}}escString(e){return null==e?"":String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}text(e){return{loading:"Loading...",error:"Error occurred",not_found:"Not found",unauthorized:"Unauthorized"}[e]||e}setSuperViewPath(e){this.CURRENT_SUPER_VIEW_PATH=e}addViewEngine(e,t){void 0===this.VIEW_MOUNTED_QUEUE[e]&&(this.VIEW_MOUNTED_QUEUE[e]=[]),this.VIEW_MOUNTED_QUEUE[e].push(t)}callViewEngineMounted(e,t){}async mountAllViewsBottomUp(e){if(!this.VIEW_MOUNTED_QUEUE[e]||!this.VIEW_MOUNTED_QUEUE[e].length)return void h.Ay.warn(`âš ï¸ View.mountAllViewsBottomUp: No views in queue for renderTimes=${e}`);this.CURRENT_SUPER_VIEW_MOUNTED||(h.Ay.log("â³ View.mountAllViewsBottomUp: Waiting for super view to be mounted..."),await new Promise(e=>{const t=setInterval(()=>{this.CURRENT_SUPER_VIEW_MOUNTED&&(clearInterval(t),e())},50)}));const t=this.VIEW_MOUNTED_QUEUE[e];h.Ay.log(`ðŸ“‹ View.mountAllViewsBottomUp: Processing ${t.length} views`);for(let e=t.length-1;e>=0;e--){const i=t[e];try{"function"==typeof i.beforeMount&&i.beforeMount(),"function"==typeof i.mounted&&i.mounted(),h.Ay.log(`âœ… View.mountAllViewsBottomUp: Successfully mounted ${i.path}`)}catch(e){h.Ay.error(`âŒ View.mountAllViewsBottomUp: Error mounting ${i.path}:`,e)}}this.VIEW_MOUNTED_QUEUE[e]=[]}async mountAllViewsFromStack(e){if(this.VIEW_MOUNTED_QUEUE[e]&&this.VIEW_MOUNTED_QUEUE[e].length){if(this.CURRENT_SUPER_VIEW_MOUNTED||(h.Ay.log("â³ View.mountAllViewsFromStack: Waiting for super view..."),await new Promise(e=>{const t=setInterval(()=>{this.CURRENT_SUPER_VIEW_MOUNTED&&(clearInterval(t),e())},50)})),this.ALL_VIEW_STACK&&this.ALL_VIEW_STACK.length>0){const e=this.SUPER_VIEW_STACK||[];for(let t=e.length-1;t>=0;t--){const i=e[t];try{"function"==typeof i.beforeMount&&i.beforeMount(),"function"==typeof i.mounted&&i.mounted()}catch(e){h.Ay.error(`âŒ Error mounting super view ${i.path}:`,e)}}for(let t=this.ALL_VIEW_STACK.length-1;t>=0;t--){const i=this.ALL_VIEW_STACK[t];if(!e.includes(i))try{"function"==typeof i.beforeMount&&i.beforeMount(),"function"==typeof i.mounted&&i.mounted()}catch(e){h.Ay.error(`âŒ Error mounting view ${i.path}:`,e)}}this.ALL_VIEW_STACK=[],this.SUPER_VIEW_STACK=[]}else await this.mountAllViewsBottomUp(e);this.VIEW_MOUNTED_QUEUE[e]=[]}else h.Ay.warn("âš ï¸ View.mountAllViewsFromStack: No views in queue")}templateToDom(e){const t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}include(e,t={}){try{return this.view(e,{...t},!1)}catch(t){return console.error(`App.View.include error for '${e}':`,t),""}}includeIf(e,t={}){try{return this.exists(e)?this.include(e,t):null}catch(t){return console.error(`App.View.includeIf error for '${e}':`,t),null}}extendView(e,t={}){try{const i=this.view(e,(0,s.vI)(t)?t:null,!0);return i?(this.cachedViews[e]=i,this.cachedViews[e]):null}catch(e){return null}}registerSubscribe(e,t,i=""){let n="";const r=[];if("string"==typeof e)n+=` ${e}="${this.yieldContent(t,i)}"`,r.push(`${e}:${t}`);else if("object"==typeof e){const t=Object.keys(e);for(const s of t)"#content"===s.toLowerCase()?n+=` ${c.a.KEYS.YIELD_CONTENT}="${e[s]}"`:"#children"===s.toLowerCase()?n+=` ${c.a.KEYS.YIELD_CHILDREN}="${e[s]}"`:(n+=` ${s}="${this.yieldContent(e[s],i)}"`,r.push(`${s}:${e[s]}`))}return n+=` ${c.a.KEYS.YIELD_ATTR}="${r.join(",")}"`,n}exists(e){return!(!this.templates||!this.templates[e])}renderOrScanView(e,t=null,i="csr"){let n=null;const r=this.renderTimes,s="ssr"===i?"virtualRender":"render",o="ssr"===i?"virtualPrerender":"prerender";if(!e.hasAwaitData&&!e.hasFetchData)return t&&e.updateVariableData({...t}),n=e[s](),n;const a=e.hasPrerender;return a||(t&&e.updateVariableData(t),n=e[s]()),e.hasAwaitData?(a&&(n=e[o]()),"csr"===i?this.App.API.getURIDAta().then(t=>{e.updateVariableData(t),e[s]()}):(n=e[s](),addToQueue&&this.callViewEngineMounted(r,e.id))):e.hasFetchData&&(a&&(n=e[o]()),"csr"===i?(e.fetch,this.App.API.getURIDAta().then(t=>{e.updateVariableData(t),e[s](),addToQueue&&this.callViewEngineMounted(r,e.id)})):(n=e[s](),addToQueue&&this.callViewEngineMounted(r,e.id))),n}renderView(e,t=null){return this.renderOrScanView(e,t,"csr")}scanRenderedView(e,t=null){return this.renderOrScanView(e,t,"ssr")}view(e,t=null,i=!1){try{if(i&&this.cachedViews[e]){const i=this.cachedViews[e];return i.reset(),t&&i.updateVariableData({...t}),i}if(!this.templates[e])return console.warn(`App.View.view: View '${e}' not found in scope '${scope}'`),null;if("function"!=typeof this.templates[e])return console.warn(`App.View.view: View '${e}' render function is not valid`),null;const n=(0,this.templates[e])(t?{...t}:{},{App:this.App,View:this});return n?(n.setApp(this.App),this.cachedViews[e]=n,n):(console.error(`App.View.view: View config not found for '${e}' in scope '${scope}'`),null)}catch(t){return console.error(`App.View.view: Critical error loading view '${e}':`,t),null}}clearOldRendering(){const e=this.renderTimes;if(e>3){const t=e-3;if(this.VIEW_MOUNTED_QUEUE[t]){const e=this.VIEW_MOUNTED_QUEUE[t];Array.isArray(e)&&e.forEach(e=>{e&&"object"==typeof e&&this.unmountView(e)}),delete this.VIEW_MOUNTED_QUEUE[t]}}const t=Object.keys(this.cachedViews);t.length>50&&t.slice(0,t.length-50).forEach(e=>{const t=this.cachedViews[e];t&&this.unmountView(t),delete this.cachedViews[e]}),this.ALL_VIEW_STACK=[],this.SUPER_VIEW_STACK=[],this.PAGE_VIEW=null,this.clearOrphanedEventData()}unmountView(e){if(!e||"object"!=typeof e)return h.Ay.warn("âš ï¸ View.unmountView: Invalid view object"),!1;try{return h.Ay.log(`ðŸ—‘ï¸ View.unmountView: Unmounting view ${e.id} (${e.path})`),"function"==typeof e.beforeUnmount&&e.beforeUnmount(),"function"==typeof e.removeEvents&&e.removeEvents(),this.viewMap.has(e.id)&&this.viewMap.delete(e.id),"function"==typeof e.unmounted&&e.unmounted(),"function"==typeof e.destroy&&e.destroy(),h.Ay.log(`âœ… View.unmountView: View ${e.id} unmounted successfully`),!0}catch(t){return h.Ay.error(`âŒ View.unmountView: Error unmounting view ${e.id}:`,t),!1}}resetView(){h.Ay.log("ðŸ”„ View.resetView: Resetting view stacks"),this.SUPER_VIEW_STACK=[],this.ALL_VIEW_STACK=[],this.PAGE_VIEW=null}clearOrphanedEventData(){h.Ay.log("ðŸ—‘ï¸ View.clearOrphanedEventData: Cleaning up orphaned event handlers"),Object.values(this.cachedViews).forEach(e=>{e&&"function"==typeof e.clearOrphanedEventData&&e.clearOrphanedEventData()}),[...this.ALL_VIEW_STACK,...this.SUPER_VIEW_STACK].forEach(e=>{e&&"function"==typeof e.clearOrphanedEventData&&e.clearOrphanedEventData()}),this.CURRENT_VIEW&&"function"==typeof this.CURRENT_VIEW.clearOrphanedEventData&&this.CURRENT_VIEW.clearOrphanedEventData(),this.CURRENT_SUPER_VIEW&&"function"==typeof this.CURRENT_SUPER_VIEW.clearOrphanedEventData&&this.CURRENT_SUPER_VIEW.clearOrphanedEventData()}section(e,t,i="string"){let n=this._sections[e];this._sections[e]=t,n!==t&&this._changedSections.push(e)}yield(e,t=""){return this._sections[e]||t}yieldContent(e,t=""){return this._sections[e]||t}renderSections(){let e="";for(const[t,i]of Object.entries(this._sections))e+=i;return e}hasSection(e){return e in this._sections}getChangedSections(){return this._changedSections}resetChangedSections(){this._changedSections=[]}isChangedSection(e){return this._changedSections.includes(e)}emitChangedSections(){this._changedSections.forEach(e=>{if(this.SEO.updateItem(e,this._sections[e]))return;const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");document.querySelectorAll(`[data-yield-subscribe-key*="${t}"]`).forEach(t=>{const i=t.getAttribute("data-yield-subscribe-key"),n=t.getAttribute("data-yield-subscribe-target"),r=t.getAttribute("data-yield-subscribe-attr");if(i&&i.includes(e)){const i=this._sections[e]||"";"content"===n||"children"===n?t.innerHTML=i:"attr"===n||"attribute"===n?r&&t.setAttribute(r,i):t.innerHTML=i}}),document.querySelectorAll("[data-yield-attr]").forEach(t=>{const i=t.getAttribute("data-yield-attr");i&&i.includes(e)&&i.split(",").forEach(i=>{let n=i.split(":"),r=n.shift(),s=n.join(":");if(s&&s.trim()===e){const i=this._sections[e]||"";t.setAttribute(r.trim(),i)}})}),e.split(":").length<=1&&document.querySelectorAll(`[data-yield-${t}]`).forEach(t=>{const i=this._sections[e]||"";t.innerHTML=i}),document.querySelectorAll(`[data-yield-content="${t}"]`).forEach(t=>{t.innerHTML=this._sections[e]||""}),document.querySelectorAll(`[data-yield-children="${t}"]`).forEach(t=>{t.innerHTML=this._sections[e]||""})}),this.resetChangedSections()}loadServerData(e={}){}push(e,t){this._stacks[e]||(this._stacks[e]=[]),this._stacks[e].push(t)}stack(e){return this._stacks[e]?this._stacks[e].join(""):""}once(e){const t=this._hashContent(e);return this._once[t]?"":(this._once[t]=!0,e)}_hashContent(e){let t=0;if(0===e.length)return t.toString();for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return t.toString()}isAuth(e=null){return!1}can(e,t=null){return!1}hasError(e){return!1}firstError(e){return""}csrfToken(){return""}foreach(e,t){if(!e)return"";let i="";return Array.isArray(e)?e.forEach((e,n)=>{i+=t(e,n)}):"object"==typeof e&&Object.entries(e).forEach(([e,n])=>{i+=t(n,e)}),i}route(e,t={}){return this.App.Router.getURL(e,t)}}}}]);
//# sourceMappingURL=core-c492f101.js.map